MATCH (start:Stop)
WHERE start.stop_name CONTAINS "Wagonownia"
MATCH (trip:Trip)-[r_start:STOPS_AT]->(start)
MATCH (trip)-[:VALID_ON]->(c:Calendar)
WHERE c.monday = TRUE 
  AND r_start.arrival_time >= "08:45:00"
MATCH (trip)-[r_dest:STOPS_AT]->(dest:Stop)
WHERE r_dest.stop_sequence >= r_start.stop_sequence
RETURN 
  trip.trip_id,
  trip.trip_headsign,
  dest.stop_name,
  r_dest.arrival_time,
  r_dest.stop_sequence,
  r_start.arrival_time AS start_time
ORDER BY 
  r_start.arrival_time ASC,   // <--- 1. Najważniejsze: Sortuj od najwcześniejszego odjazdu z Wagonowni
  trip.trip_id ASC,           // 2. Grupuj wiersze tego samego autobusu (dla porządku)
  r_dest.stop_sequence ASC    // 3. Układaj przystanki po kolei w ramach trasy
LIMIT 50;